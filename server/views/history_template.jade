block content
  - var month=["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"]
  - var date = response.data.date
  - var data = response.data
  - var dayData = data.dayData
  - var weekData = data.weekData
  - var monthData = data.monthData
  .row#day
    .col-md-12
      .row#dayChart
        .col-md-12
          .card
            .card-header
              h4.card-title
                p Daily Execution Report For !{month[(date.split('-')[1])-1]}, !{date.split('-')[0]}, !{date.split('-')[2]} 
            .col-md-8
              .card-plain#graph(style='padding:0px;margin:0px')
                .ct-chart#dayBar(style='height:360px;padding:0px;margin:0px')
              .card-content
                h4.title Daily Runs
                p #{date}
                p.category
                  span.text-success#dayPass
                    //i.fa.fa-long-arrow-up
                    //| #{percentage}% pass in today's run.
                    //| #{} pass in today's run.
                p.category
                  span.text-danger#dayFail
                    //i.fa.fa-long-arrow-down
                    //| #{100-percentage}% fail in today's run.
                    //| #{} fail in today's run.
            .col-lg-4.col-md-12#daily1
              .card-plain
                .ct-chart#dayPie(style='height:360px')
      .row#dayTable
        .col-md-12
          .card
            .card-header
              h4.card-title
                p Daily Execution Report For !{month[(date.split('-')[1])-1]}, !{date.split('-')[0]}, !{date.split('-')[2]} 
            .card-content.table-responsive.table-full-width#table
              table.table
                thead.text-danger
                  th HostName
                  th Total
                  th Pass
                  th Fail
                  th Pass%
                  th Fail%
                tbody
                  each val in dayData
                    tr
                      td !{val.AUTOMATION_HOST}
                      td !{val.TOTAL_SCRIPTS}
                      td !{val.TOTAL_PASSED}
                      td !{val.TOTAL_FAILED}
                      td !{Math.round(val.TOTAL_PASSED/val.TOTAL_SCRIPTS*100)}
                      td !{Math.round(val.TOTAL_FAILED/val.TOTAL_SCRIPTS*100)}

  .row#week
    .col-md-12
      .row#weekChart
        .col-md-12
          .card
            .card-header
              h4.card-title#h2
                p Weekly Execution Report For !{month[(date.split('-')[1])-1]}, !{date.split('-')[0]}, !{date.split('-')[2]} 
              p.category
            .col-md-8
              .card-plain(style='padding:0px;margin:0px')
                .ct-chart#weekBar(style='height:360px;padding:0px;margin:0px')
              .card-content
                h4.title Weekly Runs
                p #{date}
                p.category
                  span.text-success#weekPass
                    //i.fa.fa-long-arrow-up
                    //| #{percentage1}% pass in weekly run.
                    //|77 
                  //| pass
                p.category
                  span.text-danger#weekFail
                    //i.fa.fa-long-arrow-down
                      //| #{100-percentage1}% fail in weekly run.
                    //| #{} fail in weekly run.
            .col-lg-4.col-md-12.col-sm-7#week1
              .card-plain
                .ct-chart#weekPie(style='height:360px')      
      .row#weekTable
        .col-md-12
          .card
            .card-header
              h4.card-title
                p Weekly Execution Report For !{month[(date.split('-')[1])-1]}, !{date.split('-')[0]}, !{date.split('-')[2]} 
            .card-content.table-responsive.table-full-width#table
              table.table
                thead.text-danger
                  th HostName
                  th Total
                  th Pass
                  th Fail
                  th Pass%
                  th Fail%
                tbody
                  each val in weekData
                    tr
                      td !{val.AUTOMATION_HOST}
                      td !{val.TOTAL_SCRIPTS}
                      td !{val.TOTAL_PASSED}
                      td !{val.TOTAL_FAILED}
                      td !{Math.round(val.TOTAL_PASSED/val.TOTAL_SCRIPTS*100)}
                      td !{Math.round(val.TOTAL_FAILED/val.TOTAL_SCRIPTS*100)}
                
  .row#month
    .col-md-12
      .row#monthChart
        .col-md-12
          .card
            .card-header
              h4.card-title
                p Monthly Execution Report For !{month[(date.split('-')[1])-1]} , !{date.split('-')[2]}
              p.category
            .col-md-8
              .card-plain(style='padding:0px;margin:0px')
                .ct-chart#monthBar(style='height:360px;padding:0px;margin:0px')
              .card-content
                h4.title Monthly Runs
                p#head 
                p.category
                  span.text-success#monthPass
                    //i.fa.fa-long-arrow-up
                      //| #{percentage2}% pass in monthly run.
                    //| #{} pass in monthly run.
                p.category
                  span.text-danger#monthFail
                    //i.fa.fa-long-arrow-down
                      //| #{100-percentage2}% fail in monthly run.
                    //| #{} fail in monthly run.
            .col-lg-4.col-md-12.col-sm-7#monthly1
              .card-plain
                .ct-chart#monthPie(style='height:360px')
      .row#monthTable
        .col-md-12
          .card
            .card-header
              h4.card-title
                p Monthly Execution Report For !{month[(date.split('-')[1])-1]} , !{date.split('-')[2]}
            .card-content.table-responsive.table-full-width#table
              table.table
                thead.text-danger
                  th HostName
                  th Total
                  th Pass
                  th Fail
                  th Pass%
                  th Fail%
                tbody
                  each val in monthData
                    tr
                      td !{val.AUTOMATION_HOST}
                      td !{val.TOTAL_SCRIPTS}
                      td !{val.TOTAL_PASSED}
                      td !{val.TOTAL_FAILED}
                      td !{Math.round(val.TOTAL_PASSED/val.TOTAL_SCRIPTS*100)}
                      td !{Math.round(val.TOTAL_FAILED/val.TOTAL_SCRIPTS*100)}
append footerScripts
  script(type='text/javascript', src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js')
  script(type='text/javascript', src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/jquery-ui.min.js')
  //script(src='/js/notify.js')
  script(src='/js/bootstrap-notify.js')
  script(src='/js/echarts.min.js')
  script(type='text/javascript').
    $(function(){
      $( "#datepicker" ).datepicker();
      });
    $('#datepicker').datepicker({
    onSelect : function (dateText, inst) {
    $('#formId').submit()
    }});
    function showNotification(from, align, icon, type, msg){
      $.notify({
        icon: icon,
        message: msg
      },{
        type: type,
        timer: 4000,
        placement: {
          from: from,
          align: align
        }
      });
    }

  script.
    //bar chart
    //var title = !{JSON.stringify(title)};
    var data = !{JSON.stringify(response.data)};
    console.log("Data:"+JSON.stringify(data,null,2));
    $('#day').hide();
    $('#week').hide();
    $('#month').hide();

    $('#dayTable').hide();
    $('#weekTable').hide();
    $('#monthTable').hide();

    //date = JSON.parse("["+date+"]");
    var month=["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"];
    //var h1="Daily Execution Report for"+" "+m+" "+g1[1]+","+g1[2];
    //var h2="Weekly Execution Report for"+" "+m+" "+g2[1]+","+g1[2];
    //var p2="Weekly Execution Report for"+" "+m+'\n';
    //var p3=g2[0]+"-"+g1[0]+","+g1[2];
    //var h3="Monthly Execution Report for"+" "+m;
    
    validateAndProcess(data);


    function setBarChart(chart, xaxisData, pass, fail, total){
      var config = {
      rotate: 90,
      align: 'center',
      verticalAlign: 'middle',
      position: 'top',
      distance: 15,
      };
      var labelOption = {
        normal: {
          show: true,
          position: config.position,
          distance: config.distance,
          align: config.align,
          verticalAlign: config.verticalAlign,
          //rotate: config.rotate,
          //formatter: '{c}  {name|{a}}',
          fontSize: 16,
          rich: {
            name: {
              color: '#fff'
            }
          }
        }
      };

      var option = {
        color: ['#48a44c', '#e73d3a', '#0c84eb'],
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'shadow'
          }
        },
        legend: {
          data: ['Pass', 'Fail', 'Total']
        },
        toolbox: {
          show: false,
          orient: 'vertical',
          left: 'right',
          top: 'center',
          feature: {
            mark: {show: true},
            dataView: {show: true, readOnly: false},
            magicType: {show: true, type: ['line', 'bar', 'stack', 'tiled']},
            restore: {show: true},
            saveAsImage: {show: true}
          }
        },
        calculable: true,
        xAxis: [
          {
            type: 'category',
            axisTick: {show: false},
            //data: ['Desktop1', 'Desktop2', 'Desktop3', 'Desktop4', 'Desktop5']
            data : xaxisData,
            axisLabel:{rotate:20}         
          }

            //data : labels            }
        ],
        yAxis: [
          {
            type: 'value'
          }
        ],
        series: [
          {
            name: 'Pass',
            type: 'bar',
            barGap: 0,
            label: labelOption,
            //data: [320, 332, 301, 334, 390]
            data: pass
          },
          {
            name: 'Fail',
            type: 'bar',
            label: labelOption,
            //data: [220, 182, 191, 234, 290]
            data: fail
          },
          {
            name: 'Total',
            type: 'bar',
            label: labelOption,
            //data: [150, 232, 201, 154, 190]
            data: total
          }
        ]
      };
      chart.setOption(option);
    }

    function setPieChart(chart,passPercentage,failPercentage){
      pieOption = {
        title : {
          //text: 'Daily Run',
          //subtext: date,
          x:'center'
        },
        tooltip : {
          trigger: 'item',
          formatter: "({a}:{b}:{c}: {d}%)"
        },
        legend: {
          orient: 'vertical',
          left: 'left',
          data: ['Pass','Fail']
        },
        series : [
          {
            name: 'Results',
            type: 'pie',
            radius : '55%',
            label: {
              normal: {
                position: 'inner',
                formatter: '{d}%'
              }
            },
            center: ['50%', '60%'],
            data:[
              {value:passPercentage, name:'Pass',color:'green'},
              {value:failPercentage, name:'Fail',color:'red'},
            ],
            color:['#48a44c', '#e73d3a'],
            itemStyle: {
              emphasis: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }
        ]
      };
      chart.setOption(pieOption);
    }
    function validateAndProcess(data){
      if(data.dayData.length == 0 && data.weekData.length == 0 && data.monthData.length == 0){
        var msg="No Data Available Please Select another date";
        $('#day').hide();
        $('#week').hide();
        $('#month').hide();

        showNotification('top','center','error_outline','danger',msg);
      }

      if(data.dayData.length == 0){
        var msg="Day data not available, Please Select another date";
        $('#day').hide();
        showNotification('top','center','error_outline','danger',msg);
      }else{
        $('#day').fadeIn(1000);
        var dayBar = echarts.init(document.getElementById('dayBar'));
        var dayPie = echarts.init(document.getElementById('dayPie'));
        //day
        var dayData = data.dayData;
        var xaxisData = [],dPass=[],dFail=[],dTotal=[],sumPass=0,sumFail=0,sumTotal=0 ;
        dayData.forEach(element => {
          //xaxisData.push(element.AUTOMATION_HOST);
          xaxisData.push(element.HOST_NAME+'-'+element.ENVIRONMENT);
          dPass.push(element.TOTAL_PASSED) ;
          dFail.push(element.TOTAL_FAILED) ;
          dTotal.push(element.TOTAL_SCRIPTS) ;

          sumPass+=element.TOTAL_PASSED;
          sumFail+= element.TOTAL_FAILED;
          sumTotal+=element.TOTAL_SCRIPTS;
        });
        console.log("week:"+xaxisData+':'+dPass+':'+dFail+':'+dTotal);
        $('#dayPass').html(""+ sumPass+" Pass");
        $('#dayFail').html(sumFail+" Fail")
        setBarChart(dayBar,xaxisData,dPass,dFail,dTotal);
        var passPercentage = Math.round(sumPass/sumTotal*100);
        var failPercentage = Math.round(sumFail/sumTotal*100);
        setPieChart(dayPie,passPercentage,failPercentage);      
      }
      
      if(data.weekData.length == 0){
        var msg="Week data not available, Please Select another date";
        $('#week').hide();
        showNotification('top','center','error_outline','danger',msg);
      }else{
        $('#week').fadeIn(1000);
        var weekBar = echarts.init(document.getElementById('weekBar'));
        var weekPie = echarts.init(document.getElementById('weekPie'));
      
        //week
        var weekData = data.weekData;
        var xaxisData=[],wPass=[],wFail=[],wTotal=[],sumPass=0,sumFail=0,sumTotal=0 ;
        weekData.forEach(element => {
          //xaxisData.push(element.AUTOMATION_HOST);
          xaxisData.push(element.HOST_NAME+'-'+element.ENVIRONMENT);
          wPass.push(element.TOTAL_PASSED) ;
          wFail.push(element.TOTAL_FAILED) ;
          wTotal.push(element.TOTAL_SCRIPTS) ;

          sumPass+=element.TOTAL_PASSED;
          sumFail+= element.TOTAL_FAILED;
          sumTotal+=element.TOTAL_SCRIPTS;
          
        });
        console.log("week:"+xaxisData+':'+wPass+':'+wFail+':'+wTotal);
        $('#weekPass').html(""+ sumPass+" Pass");
        $('#weekFail').html(""+ sumFail+" Fail");
        setBarChart(weekBar,xaxisData,wPass,wFail,wTotal);
        var passPercentage = Math.round(sumPass/sumTotal*100);
        var failPercentage = Math.round(sumFail/sumTotal*100);
        setPieChart(weekPie,passPercentage,failPercentage);  
      }

      if(data.monthData.length == 0){
        var msg="Month data not available, Please Select another date";
        $('#month').hide();
        showNotification('top','center','error_outline','danger',msg);
      }else{
        $('#month').fadeIn(1000);
        var monthBar = echarts.init(document.getElementById('monthBar'));
        var monthPie = echarts.init(document.getElementById('monthPie'));

        //month
        var monthData = data.monthData;
        var xaxisData=[],mPass=[],mFail=[],mTotal=[],sumPass=0,sumFail=0,sumTotal=0 ;
        monthData.forEach(element => {
          //xaxisData.push(element.AUTOMATION_HOST);
          xaxisData.push(element.HOST_NAME+'-'+element.ENVIRONMENT);
          mPass.push(element.TOTAL_PASSED) ;
          mFail.push(element.TOTAL_FAILED) ;
          mTotal.push(element.TOTAL_SCRIPTS) ;

          sumPass+=element.TOTAL_PASSED;
          sumFail+= element.TOTAL_FAILED;
          sumTotal+=element.TOTAL_SCRIPTS;
          
        });
        console.log("week:"+xaxisData+':'+mPass+':'+mFail+':'+mTotal);
        $('#monthPass').html(""+ sumPass+" Pass");
        $('#monthFail').html(""+ sumFail+" Fail");
        setBarChart(monthBar,xaxisData,mPass,mFail,mTotal);
        var passPercentage = Math.round(sumPass/sumTotal*100);
        var failPercentage = Math.round(sumFail/sumTotal*100);
        setPieChart(monthPie,passPercentage,failPercentage);
      }
    }

    $('.freqDropdown').click(function() {
      console.log('clicked');
      console.log($('#btnFreq').text());
      var freq=$(this).text();
      console.log(freq);
      $('#btnFreq').text($(this).text());
      if(freq=='Graph'){
        $('#dayTable').hide();
        $('#weekTable').hide();
        $('#monthTable').hide();
        $('#dayChart').fadeIn(1000);
        $('#weekChart').fadeIn(1000);
        $('#monthChart').fadeIn(1000);
        
      }
      else{
        $('#dayChart').hide();
        $('#weekChart').hide();
        $('#monthChart').hide();
        $('#dayTable').fadeIn(1000);
        $('#weekTable').fadeIn(1000);
        $('#monthTable').fadeIn(1000);
      }
    });
    
